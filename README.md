# Телеграм бот - финансовый помощник

### Разрабочик

> **Шарапов Егор Сергеевич БПИ219**

## Задача
Телеграм-бот должен предоставлять возможность пользователем мессенджера «Telegram» получать статистику о тратах и доходах,
выводимую в виде отчёта за произвольный период в формате .XLSX, краткий отчёт в сообщениях по месяцам и отчёт о состоянии бюджета за текущий месяц.
Также программный продукт должен предоставлять возможность задавать события трат и доходов на определённое число месяца, а также добавлять траты или доходы не только вручную, но и с помощью сканирования QR-кода из чека.
Реализованные методы импорта и экспорта данных должны быть реализованы, чтобы помочь в случае, если пользователь какое-то время сам ввел бюджет или хочет некоторое время вести его офлайн.
Лимит по потраченным средствам должен позволить пользователю узнать о превышении заданной суммы в отчёте о бюджете,
а цель по сохранённым финансам должна помочь экономить личные или семейные средства.
## Требования

#### Язык

- **Python 3.11**

#### Библиотеки

> Взаимодействие с API Telegram
> - **aiogram** - _MIT license_

> Парсинг сайтов
>- **requests** - _Apache License 2.0_
> - **bs4** - _MIT license_

> Хранение данных и логирование
>- **logging** - _Apache License 2.0_
>- **sqlite3** - _MIT License_

> Работа со временем
> - **time** - _PSF LICENSE_
> - **datetime** - _Apache License 2.0_
> - **calendar** - _Apache License 2.0_
> - **dateutil** - _Apache License 2.0_

> Работа с файловой системой
> - **os** - _PSF LICENSE_
> - **pathlib** - _Apache License 2.0_

> Запись файлов в формате таблиц
> - **csv** - _PSF LICENSE_
> - **xlsxwriter** - _BSD 2-Clause License_

> Компьютерное зрение
> - **cv2** - _MIT license_
> - **pyzbar** - _MIT license_

> Дополнительно
> - **re** - _PSF LICENSE_

## Структура

### Модули

> ### **database**
> Данный модуль занимается хранением данных и работой с db.
> - **data** _(хранит db для каждого отдельного пользователя)_
> - db_functions.py _(содержит асинхронные функции взаимодействия с db)_


> ### **handlers**
> Данный модуль занимается работой с пользователем через перехват его сообщений и состояний.
> - **button_handlers** _(содержит хэндлеры для работы внутри меню бота)_
>   > - income_spend_handlers.py _(содержит хэндлеры для работы с меню удаления и добавления категорий, удаления записей)_
>   > - report_handlers.py _(содержит хэндлеры для работы с меню отчётов)_
>   > - settings_handlers.py _(содержит хэндлеры для работы в меню настроек бота)_
> - **data_handlers** _(содержит хэндлеры для работы c информацией от пользователя)_
>   > - document_handlers.py _(содержит хэндлеры для работы с документами и фото от пользователя)_
>   > - text_handlers.py _(содержит хэндлеры для работы с тестом от пользователя)_
> - **keyboards** _(содержит клавиатуры и асинхронные функции для их создания)_
>   > - inline_keyboards.py _(содержит готовые инлайн клавиатуры и асинхронные функции для их генерации)_
>   > - keyboard.py _(содержит клавиатуру главного меню)_
> - **models** _(содержит хэндлеры для работы внутри меню бота)_
>   > - categories_deletion_models.py _(содержит модель, набор состояний, для работы с категориями)_
>   > - income_spend.py _(содержит модель, набор состояний, для работы с сумами доходов и трат)_
>   > - report_model.py _(содержит модель, набор состояний, для работы с отчётом)_
>   > - settings_model.py _(содержит модель, набор состояний, для работы с настройками)_
> - client.py _(содержит главные хэндлеры бота, ответственные за обработку команд)_


> ### **helpers**
> Данный модуль занимается работой с некоторыми данными и содержит вспомогательные функции.
> - export.py _(содержит асинхронную функцию для экспорта данных)_
> - full_report.py _(содержит асинхронные функции для создания отчёта Excel)_
> - helpers.py _(содержит функции для помощи с работой со временем)_
> - import_data.py _(содержит асинхронные для работы с импортом данных)_
> - information.py _(содержит асинхронные функции для создания сообщений с бюджетом)_
> - parser.py _(содержит асинхронные функции для парсинга и получения валют)_
> - qr_scanner.py _(содержит асинхронную функцию для получения данных с qr кода)_
> - report.py _(содержит асинхронные функции для создания отчёта в виде сообщения)_

> ### **texts**
> Данный модуль занимается хранением данных и работой с db.
> - **ru_RU** _(содержит сообщения на русском языке)_
>   > - messages.py _(содержит сообщения для пользователя на русском языке)_

### Машина состояний

Работа с пользователем внутри команд основано на состояниях машины состояний, чтобы обеспечить точную работу с данными,
полученными от пользователя.

### База данных

Данные хранятся в отдельных db для каждого пользователя.
Каждая db содержит 6 таблиц:

- categories _(содержит категории и подкатегории трат пользователя)_
- events_income _(содержит информации о событиях дохода пользователя)_
- events_spend _(содержит информации о событиях трат пользователя)_
- income _(содержит информацию о доходах пользователя)_
- spend _(содержит информацию о тратах пользователя)_
- user_data _(содержит информацию о пользователе)_

### Запуск

Запустите main.py вручную, либо через консоль:\
``
python3 main.py
``
